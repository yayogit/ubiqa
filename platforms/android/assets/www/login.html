<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ubiqarama</title>

    <!-- Bootstrap -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="css/bootstrap-dialog.min.css" rel="stylesheet" type="text/css" />

    <!-- theme css // tema del la app -->
    <link href="assets/css/theme.css" rel="stylesheet">
    <link href="assets/css/icons.css" rel="stylesheet">
    

    <link href="assets/css/simple-sidebar.css" rel="stylesheet">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

     <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="dist/js/bootstrap.min.js"></script>
    <!-- Custom JavaScript for the Menu Toggle -->

    <!-- Pop Up JS -->
    <link href="assets/css/popup.css" rel="stylesheet">
    <script src="assets/js/popup.js"></script>
    
    <!--  truncating character with ellipsis -->
    <script src="assets/js/succinct.js"></script>
  
    
    <script src="assets/audiojs/audio.min.js"></script>
    
    
<!-- YYY Carga de scripts  -->
	
    <script src="js/jquery/jquery.mobile-1.4.2.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="js/bootstrap-dialog.min.js"></script>
    <script src="js/ddc_phonegap_utils.js"></script>
    <script src="js/config_ubiqarama.js"></script>
    <script src="js/model_ubiqarama.js"></script>
    <script src="js/utils_ubiqarama.js"></script>
    <script src="js/api_ubiqarama.js"></script>
<!-- Fin YYY Carga de scripts  -->
    
    <!-- Run in full-screen mode. -->
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Make the status bar black with white text. -->
    <meta name="apple-mobile-web-app-status-bar-style" 
          content="black-translucent" >

    <!-- Customize home screen title. -->
    <meta name="apple-mobile-web-app-title" 
          content="Ubiqarama">

    <!-- Disable phone number detection. -->
    <meta name="format-detection" 
          content="telephone=no">

    <!-- Set viewport. -->
    <meta name="viewport" 
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- Prevent text size adjustment on orientation change. -->
    <style>html { -webkit-text-size-adjust: 100%; }</style>
    
    <style>.modal-dialog{margin-top:50%;}</style>

    <title>Ubiqarama</title>
 
    <!-- Icons -->
    
    <link rel="icon" href="assets/images/favicon.png">
        
    <!-- iOS 7 iPad (retina) -->
    <link href="assets/images/apple-touch-icon-152x152.png"
          sizes="152x152"
          rel="apple-touch-icon">

    <!-- iOS 7 iPhone (retina) -->
    <link href="assets/images/apple-touch-icon-120x120.png"
          sizes="120x120"
          rel="apple-touch-icon">
    <!-- iOS 7 iPad -->
    <link href="assets/images/apple-touch-icon-76x76.png"
          sizes="76x76"
          rel="apple-touch-icon">
 
 
    <!-- Startup images -->

    <!-- iPhone 5 -->
		<link 	href="assets/images/startup-iphone5@2x.png"
      			media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
      			rel="apple-touch-startup-image">		
		<!-- iPhone -->
		<link 	href="assets/images/startup-iphone.png"
      			media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)"
      			rel="apple-touch-startup-image">	
		<!-- iPhone (Retina) -->
		<link 	href="assets/images/startup-iphone@2x.png"
      			media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)"
      			rel="apple-touch-startup-image">
    
  </head>
  <body onload="loadCredentials();">

    <div id="wrapper">

        <!-- Page content -->
        <div id="page-content-wrapper">

            <!-- Keep all page content within the page-content inset div! -->
            <div class="page-content inset">
            	<header class="row toolbar">
              		<h1>
              	 		<span class="icon icon-icn-293"></span> Login
              	 	</h1>
                </header>
            <section class="container-fluid">
				<header class="text-center" style="margin-top:50px">
					<p>accede con tu usuario y contraseña</p>
				</header>
	            <article class="row">
					<figure>
						<div class="col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4 text-center">
							<div class="account-wall">
								<div class='avatar' style="background: url('assets/images/no-avatar.png') center center; background-size: cover">
								</div>
								
								<form class="form-signin" onsubmit="return onLogin();">
									<input id="txtServer" name="server" type="text" class="form-control" placeholder="Servidor" required autofocus>
									<input id="txtUser" name="user" type="text" class="form-control" placeholder="Usuario" required>
									<input id="txtPwd" name="pwd" type="password" class="form-control" placeholder="Password" required>
									<button class="btn btn-lg btn-danger btn-block" type="submit" >Accede</button>
									<label class="checkbox pull-left">
									<input id="chkRemember" type="checkbox" value="remember-me">Recuérdame
									</label>
									<!-- a href="ayuda.html" class="pull-right need-help">Ayuda?  --><span class="clearfix"></span>
								</form>
							</div>
							
							<a href="#" class="text-center new-account">Recupera tu contraseña </a>
						</div>         
					</figure>
	
	  			</article>
                
            </section>
        </div>
    </div>
</div>

    
    <!-- Custom methods and inits -->
    <script src="assets/js/app.js" type="text/javascript"></script>
    <script type="text/javascript">
    	/**
    	 * Obtiene las credenciales almacenadas, si existen
    	 */
    	function loadCredentials(){
    		console.log("loadCredentials");
    		func_onLoad = function(pCredentials){
    			document.getElementById("txtServer").value = pCredentials.server;
    			document.getElementById("txtUser").value = pCredentials.user;
        		document.getElementById("txtPwd").value = pCredentials.pwd;
        		if(document.getElementById("txtUser").value != ""){
        			document.getElementById("chkRemember").checked = true;	
        		}        		
    		}
    		ubiqaramaUtils.loadCredentials(func_onLoad);
    	}

    	/**
    	 * Comprueba las credenciales, obtiene la informacion del usuario y almacena las credenciales si se ha indicado
    	 */
    	function onLogin(){
    		ddcDialog.showProgress("Validando Usuario...");
    		//Corregir URL servidor
    		if(document.getElementById("txtServer").value.indexOf("http://") == -1){
    			document.getElementById("txtServer").value = "http://" + document.getElementById("txtServer").value;
    		}
    		//Obtener credenciales
    		userUbiqarama.server = document.getElementById("txtServer").value;
    		userUbiqarama.user = document.getElementById("txtUser").value;
    		userUbiqarama.pwd = document.getElementById("txtPwd").value;

    		//Mostrar pagina principal    		
    		func_onWriteOK = function(evt){
    			sessionStorage.setItem("server", userUbiqarama.server);
	    		sessionStorage.setItem("user", userUbiqarama.user);
	    		sessionStorage.setItem("pwd", userUbiqarama.pwd);
	    		ddcDialog.hideProgress();
	    		window.location = "index.html";
    		}
    		//Login
    		func_loginOK = function(result){
				console.log("login OK");
	    		//Almacenar credenciales
	    		if(document.getElementById("chkRemember").checked){
	    			//Corregir URL servidor
	        		if(document.getElementById("txtServer").value.indexOf("http://") == -1){
	        			document.getElementById("txtServer").value = "http://" + document.getElementById("txtServer").value;
	        		}
	    			ubiqaramaUtils.store(document.getElementById("txtServer").value, document.getElementById("txtUser").value, document.getElementById("txtPwd").value, func_onWriteOK);
	    		}else{
	    			ubiqaramaUtils.clear();
	    			func_onWriteOK();
	    		}	    		
			}
    		
    		func_loginError = function(xhr, ajaxOptions, trhownError){
    			ddcDialog.hideProgress();
    			console.log("Error en login");
    			if(xhr.status == 401){
    				ubiqaramaUtils.alert("Usuario o clave incorrectos");
    			}else{
    				ubiqaramaUtils.alert("Error accediendo al servidor '"+userUbiqarama.server+"',compruebe que la direccion es correcta e intentelo de nuevo");
    			}
    			return false;
    		}
			APIcalls.login(func_loginOK, func_loginError);
			return false;
    		
    	} 
    	
    	$.widget( "mobile.loader").html("");
    </script>
  </body>
</html>
